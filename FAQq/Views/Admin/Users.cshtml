@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
@using Microsoft.AspNetCore.Identity
@model IEnumerable<FAQq.Models.ApplicationUser>

<h2>Użytkownicy</h2>
@if (TempData["Roles"] != null)
{
    <div class="alert alert-success">
        Aktualne role: @TempData["Roles"]
    </div>
}

<table class="table">
    @foreach (var u in Model)
    {
        var roles = await Context.RequestServices
        .GetRequiredService<UserManager<FAQq.Models.ApplicationUser>>()
        .GetRolesAsync(u);
        bool isModerator = roles.Contains("Moderator");
        <tr>
            <td>@u.Email</td>
            <td>@string.Join(", ", roles)</td>
            <td>
                @if (!isModerator)
                {
                    <a asp-action="MakeModerator"
                       asp-route-id="@u.Id"
                       class="btn btn-success btn-sm">
                        Nadaj Moderator
                    </a>
                }
                else
                {
                    <a asp-action="RemoveModerator"
                       asp-route-id="@u.Id"
                       class="btn btn-danger btn-sm">
                        Zabierz Moderator
                    </a>
                }

                <a asp-action="DeleteUser"
                   asp-route-id="@u.Id"
                   class="btn btn-outline-danger btn-sm ms-2"
                   onclick="return confirm('Na pewno chcesz usunąć tego użytkownika?');">
                    Usuń użytkownika
                </a>
            </td>
        </tr>
    }

</table>

<a asp-action="Index">Powrót do panelu</a>
